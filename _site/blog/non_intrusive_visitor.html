<!DOCTYPE html><html lang="en"><meta charset="utf-8"><title>Non-intrusive and Acyclic Visitor</title><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="this is meta description"><link rel="stylesheet" href="/assets/plugins/bootstrap/bootstrap.min.css"><link rel="stylesheet" href="/assets/plugins/themify-icons/themify-icons.css"><link rel="stylesheet" href="/assets/plugins/slick/slick.css"><link href="/assets/scss/style.css" rel="stylesheet"><link rel="shortcut icon" href="/assets/images/favicon.png " type="image/x-icon"><link rel="icon" href="/assets/images/favicon.png " type="image/x-icon"> <script async src="https://www.googletagmanager.com/gtag/js?id=G-MM2F5FN4DZ"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-MM2F5FN4DZ'); </script></head><header class="navigation fixed-top"><nav class="navbar navbar-expand-lg navbar-dark"> <a class="navbar-brand font-tertiary h3" href="#"><h3 class="text-white font-tertiary">Blogs</h3></a> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation" aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button><div class="collapse navbar-collapse text-center" id="navigation"><ul class="navbar-nav ml-auto"><li class="nav-item active"> <a class="nav-link" href="/">Back</a></li></ul></div></nav></header><section class="page-title bg-primary position-relative"><div class="container"><div class="row"><div class="col-12 text-center"><h1 class="text-white font-tertiary">Non-intrusive and Acyclic Visitor</h1></div></div></div><img src="/assets/images/illustrations/page-title.png" alt="illustrations" class="bg-shape-1 w-100"> <img src="/assets/images/illustrations/leaf-pink-round.png" alt="illustrations" class="bg-shape-2"> <img src="/assets/images/illustrations/leaf-orange.png" alt="illustrations" class="bg-shape-4"> <img src="/assets/images/illustrations/leaf-yellow.png" alt="illustrations" class="bg-shape-5"> <img src="/assets/images/illustrations/dots-group-cyan.png" alt="illustrations" class="bg-shape-6"> <img src="/assets/images/illustrations/leaf-cyan-lg.png" alt="illustrations" class="bg-shape-7"></section><section class="section"><div class="container"><div class="row"><section class="subsection"><h3>The Visitor Pattern</h3><p> The <a class="text-dark" href="https://refactoring.guru/design-patterns/visitor">Visitor</a> is a behavioral pattern that is used to apply different algorithms to a <a class="text-dark" href="https://refactoring.guru/design-patterns/composite">Composite</a> tree structure. It is mainly used to parse the tree in different ways to achieve different outcomes. This is intended to separate the algorithm from the objects that they operate on. It can be implemented in different ways depending upon the design options and choices available at the instance.</p><object data="/uml/b6814f2d53fa6941ed9430968a5a4476.svg" type="image/svg+xml" class="plantuml"></object>i<p>The simplest implementation is extremely intrusive in which the base composite classe is modified to have a virtual visit method and the visit behavior is delegated to the subclasses for a particular algorithm, say printing. This is a bad design choice as the composite tree may be parsed in a different manner and not just for printing, and if we stick to this design choice, we would have to modify the composite classes again with virtual methods for different algorithms and this is bad for code maintainence. If we recall, the Visitor was supposed to separate the algorithm from the objects and it seems like it's not doing its job quite well.</p><object data="/uml/db1e5b9f04aee0d29bebf4a5cd9bcf11.svg" type="image/svg+xml" class="plantuml"></object><p>The next choice is a reflective visitor which behaves more like a visitor in which the algorithm is separate from the data. But this visitor relies heavily on RTTI and the casts make it a bit slower. In some time-critical parsing applications, this might not be a very good implemetation.</p><p>Can we do any better? Implementing the visitor for a strongly typed language such as C++ can be tricky. From the UML diagrams, the problem is obvious. The concrete Visitors need to know the basetype of the object to perform different operations. We can't resort to method overloading since it would default to the base composite class. To avoid this problem, we use a <a class="text-dark" href="https://refactoring.guru/design-patterns/visitor-double-dispatch"> double dispatch</a> visitor.</p><object data="/uml/00b5af1b65716ace64914545c03e0a3d.svg" type="image/svg+xml" class="plantuml"></object><p>This beautiful trick uses a conjunction of dynamic binding and method overloading to figure out the type of the composite and then uses this information to call the appropriate method for the object type.</p><p>Although neat, it also creates a cyclic dependency between the composite objects and the Visitor objects which could be bad in certain scenarios especially when it comes to code compilation and maintainence. There is a Acyclic Visitor invented by <a class="text-dark" href="https://condor.depaul.edu/dmumaugh/OOT/Design-Principles/acv.pdf"> Robert C. Martin</a> which solves this problem but introduces dynamic_cast to the equation which has its own set of problems. It is obvious that the implementation relies heavily on the use case and I will discuss the case where modifying the Composite may not be an option and thus a Non-intrusive visitor is desired. Let's see if we can make it better.</p></section></div><div class="row"><section class="subsection"><h3>Non Intrusion</h3><p> I've taken the below composite from Dmitri Nesteruk's course <a class="text-dark" href="https://www.udemy.com/course/patterns-cplusplus/"> Design Patterns in Modern C++</a> on Udemy. I've used the same structure for the UMLs above to maintain consistency.</p><noscript><pre>struct Expression {
    virtual ~Expression() {}
};

struct Value : Expression {
    int value;
    Value(int value) : value(value) {}
};

struct Addition : Expression {
    Expression &amp;lhs, &amp;rhs;
    Addition(Expression &amp;lhs, Expression &amp;rhs) : lhs(lhs), rhs(rhs) {}
};

struct Multiplication : Expression {
    Expression &amp;lhs, &amp;rhs;

    Multiplication(Expression &amp;lhs, Expression &amp;rhs)
        : lhs(lhs), rhs(rhs) {}
};</pre></noscript><script src="https://gist.github.com/436b7bc848ce57adaf185c36e6adf682.js"> </script></section></div><div class="row"><section><h3>Future Work</h3><p> I have built this to simply showcase this as a complete project built from start to finish. If people actually like this and require some new types of dice, then I can think about including those as in-app purchases to get some monetization. I have absolutely no idea on how to integrate the purchases with Google Play Store which would be a good experience in itself.</p></section></div></div></section><footer class="bg-dark"><div class="section"><div class="container"><div class="row"><div class="col-md-4"><h5 class="text-light">Email</h5><p class="text-white paragraph-lg font-secondary">SiddharthJSingh@protonmail.com</p></div><div class="col-md-4"><h5 class="text-light">Phone</h5><p class="text-white paragraph-lg font-secondary">+91 9000968078</p></div><div class="col-md-4"><h5 class="text-light">Address</h5><p class="text-white paragraph-lg font-secondary">C/O Jagpal Singh, Near E.S.I Office, 4th Cross Road, Junglighat, Port Blair-744103, India</p></div></div></div></div><div class="border-top text-center border-dark py-5"><p class="mb-0 text-light"><p>Copyright Â© 2020 Designed by <a href="https://themefisher.com">Themefisher</a> &amp; Developed by <a href="https://getjekyllthemes.com">Getjekyllthemes</a></p></p></div></footer><script src="/assets/plugins/jQuery/jquery.min.js"></script> <script src="/assets/plugins/bootstrap/bootstrap.min.js"></script> <script src="/assets/plugins/shuffle/shuffle.min.js"></script> <script src="/assets/plugins/slick/slick.min.js"></script> <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> <script src="/assets/js/script.js"></script></body></html>
