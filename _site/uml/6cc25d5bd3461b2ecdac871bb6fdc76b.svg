<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="691px" preserveAspectRatio="none" style="width:665px;height:691px;" version="1.1" viewBox="0 0 665 691" width="665px" zoomAndPan="magnify"><defs><filter height="300%" id="f2va1y7bly2yb" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[a83d828be13d333e1fddb3d4d9d97191]
class Handler--><rect codeLine="20" fill="#FEFECE" filter="url(#f2va1y7bly2yb)" height="86.4141" id="Handler" style="stroke:#A80036;stroke-width:1.5;" width="183" x="7" y="283"/><ellipse cx="69.75" cy="299" fill="#A9DCDF" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M69.8594,294.3438 L68.7031,299.4219 L71.0313,299.4219 L69.8594,294.3438 Z M68.375,292.1094 L71.3594,292.1094 L74.7188,304.5 L72.2656,304.5 L71.5,301.4375 L68.2188,301.4375 L67.4688,304.5 L65.0313,304.5 L68.375,292.1094 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="49" x="90.25" y="303.1543">Handler</text><line style="stroke:#A80036;stroke-width:1.5;" x1="8" x2="189" y1="315" y2="315"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8" x2="189" y1="323" y2="323"/><ellipse cx="18" cy="334" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacing" textLength="117" x="27" y="337.2104">handle(Value&amp; expr)</text><ellipse cx="18" cy="346.8047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacing" textLength="126" x="27" y="350.0151">handle(Addition&amp; add)</text><ellipse cx="18" cy="359.6094" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacing" textLength="157" x="27" y="362.8198">handle(Multiplication&amp; mult)</text><!--MD5=[53bf68ed638bcf4718423098b3d480ea]
class Visitor--><rect codeLine="26" fill="#FEFECE" filter="url(#f2va1y7bly2yb)" height="153.6328" id="Visitor" style="stroke:#A80036;stroke-width:1.5;" width="423" x="225" y="249"/><ellipse cx="413.25" cy="265" fill="#A9DCDF" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M413.3594,260.3438 L412.2031,265.4219 L414.5313,265.4219 L413.3594,260.3438 Z M411.875,258.1094 L414.8594,258.1094 L418.2188,270.5 L415.7656,270.5 L415,267.4375 L411.7188,267.4375 L410.9688,270.5 L408.5313,270.5 L411.875,258.1094 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="38" x="433.75" y="269.1543">Visitor</text><line style="stroke:#A80036;stroke-width:1.5;" x1="226" x2="647" y1="281" y2="281"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="233" y="289"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="341" x="245" y="295.2104">map&lt;type_index, function&lt;void(Expression &amp;)&gt;&gt; type_map</text><line style="stroke:#A80036;stroke-width:1.0;" x1="226" x2="647" y1="301.8047" y2="301.8047"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="233" y="309.8047"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="364" x="245" y="316.0151">template &lt;typename E&gt; void castAndHandle(Expression &amp;expr)</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,2.0;" x1="226" x2="647" y1="322.6094" y2="322.6094"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="145" x="245" y="336.8198">//Internal double dispatch</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="221" x="245" y="349.6245">auto casted = static_cast&lt;T &amp;&gt;(expr);</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="88" x="245" y="362.4292">handle(casted);</text><ellipse cx="236" cy="372.0234" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="174" x="245" y="375.2339">void accept(Expression &amp;expr)</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,2.0;" x1="226" x2="647" y1="381.8281" y2="381.8281"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="411" x="231" y="396.0386">//search type_map and call the specialized castAndHandle(Expression&amp;)</text><!--MD5=[3637e2e3ff64f8c7ec072f5df5e3a1dc]
class Expression--><rect codeLine="2" fill="#FEFECE" filter="url(#f2va1y7bly2yb)" height="48" id="Expression" style="stroke:#A80036;stroke-width:1.5;" width="99" x="387" y="7"/><ellipse cx="402" cy="23" fill="#A9DCDF" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M402.1094,18.3438 L400.9531,23.4219 L403.2813,23.4219 L402.1094,18.3438 Z M400.625,16.1094 L403.6094,16.1094 L406.9688,28.5 L404.5156,28.5 L403.75,25.4375 L400.4688,25.4375 L399.7188,28.5 L397.2813,28.5 L400.625,16.1094 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="67" x="416" y="27.1543">Expression</text><line style="stroke:#A80036;stroke-width:1.5;" x1="388" x2="485" y1="39" y2="39"/><line style="stroke:#A80036;stroke-width:1.5;" x1="388" x2="485" y1="47" y2="47"/><!--MD5=[ff3d20c1112759d46dde2fcead238479]
class Value--><rect codeLine="4" fill="#FEFECE" filter="url(#f2va1y7bly2yb)" height="60.8047" id="Value" style="stroke:#A80036;stroke-width:1.5;" width="74" x="267.5" y="121.5"/><ellipse cx="285.65" cy="137.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M288.6188,143.1406 Q288.0406,143.4375 287.4,143.5781 Q286.7594,143.7344 286.0563,143.7344 Q283.5563,143.7344 282.2281,142.0938 Q280.9156,140.4375 280.9156,137.3125 Q280.9156,134.1875 282.2281,132.5313 Q283.5563,130.875 286.0563,130.875 Q286.7594,130.875 287.4,131.0313 Q288.0563,131.1875 288.6188,131.4844 L288.6188,134.2031 Q287.9938,133.625 287.4,133.3594 Q286.8063,133.0781 286.1813,133.0781 Q284.8375,133.0781 284.15,134.1563 Q283.4625,135.2188 283.4625,137.3125 Q283.4625,139.4063 284.15,140.4844 Q284.8375,141.5469 286.1813,141.5469 Q286.8063,141.5469 287.4,141.2813 Q287.9938,141 288.6188,140.4219 L288.6188,143.1406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="35" x="300.35" y="141.6543">Value</text><line style="stroke:#A80036;stroke-width:1.5;" x1="268.5" x2="340.5" y1="153.5" y2="153.5"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="275.5" y="161.5"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="48" x="287.5" y="167.7104">int value</text><line style="stroke:#A80036;stroke-width:1.5;" x1="268.5" x2="340.5" y1="174.3047" y2="174.3047"/><!--MD5=[4e916b5516e51ac6308a192ab863475a]
class Addition--><rect codeLine="7" fill="#FEFECE" filter="url(#f2va1y7bly2yb)" height="73.6094" id="Addition" style="stroke:#A80036;stroke-width:1.5;" width="120" x="376.5" y="115"/><ellipse cx="408.15" cy="131" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M411.1188,136.6406 Q410.5406,136.9375 409.9,137.0781 Q409.2594,137.2344 408.5563,137.2344 Q406.0563,137.2344 404.7281,135.5938 Q403.4156,133.9375 403.4156,130.8125 Q403.4156,127.6875 404.7281,126.0313 Q406.0563,124.375 408.5563,124.375 Q409.2594,124.375 409.9,124.5313 Q410.5563,124.6875 411.1188,124.9844 L411.1188,127.7031 Q410.4938,127.125 409.9,126.8594 Q409.3063,126.5781 408.6813,126.5781 Q407.3375,126.5781 406.65,127.6563 Q405.9625,128.7188 405.9625,130.8125 Q405.9625,132.9063 406.65,133.9844 Q407.3375,135.0469 408.6813,135.0469 Q409.3063,135.0469 409.9,134.7813 Q410.4938,134.5 411.1188,133.9219 L411.1188,136.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="51" x="425.85" y="135.1543">Addition</text><line style="stroke:#A80036;stroke-width:1.5;" x1="377.5" x2="495.5" y1="147" y2="147"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="384.5" y="155"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="94" x="396.5" y="161.2104">Expression&amp; lhs</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="384.5" y="167.8047"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="94" x="396.5" y="174.0151">Expression&amp; lhs</text><line style="stroke:#A80036;stroke-width:1.5;" x1="377.5" x2="495.5" y1="180.6094" y2="180.6094"/><!--MD5=[a80aeb25cfca85a61c4213d8f76e28b6]
class Multiplication--><rect codeLine="11" fill="#FEFECE" filter="url(#f2va1y7bly2yb)" height="73.6094" id="Multiplication" style="stroke:#A80036;stroke-width:1.5;" width="120" x="531.5" y="115"/><ellipse cx="549.2" cy="131" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M552.1688,136.6406 Q551.5906,136.9375 550.95,137.0781 Q550.3094,137.2344 549.6063,137.2344 Q547.1063,137.2344 545.7781,135.5938 Q544.4656,133.9375 544.4656,130.8125 Q544.4656,127.6875 545.7781,126.0313 Q547.1063,124.375 549.6063,124.375 Q550.3094,124.375 550.95,124.5313 Q551.6063,124.6875 552.1688,124.9844 L552.1688,127.7031 Q551.5438,127.125 550.95,126.8594 Q550.3563,126.5781 549.7313,126.5781 Q548.3875,126.5781 547.7,127.6563 Q547.0125,128.7188 547.0125,130.8125 Q547.0125,132.9063 547.7,133.9844 Q548.3875,135.0469 549.7313,135.0469 Q550.3563,135.0469 550.95,134.7813 Q551.5438,134.5 552.1688,133.9219 L552.1688,136.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="82" x="563.8" y="135.1543">Multiplication</text><line style="stroke:#A80036;stroke-width:1.5;" x1="532.5" x2="650.5" y1="147" y2="147"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="539.5" y="155"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="94" x="551.5" y="161.2104">Expression&amp; lhs</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="539.5" y="167.8047"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="94" x="551.5" y="174.0151">Expression&amp; lhs</text><line style="stroke:#A80036;stroke-width:1.5;" x1="532.5" x2="650.5" y1="180.6094" y2="180.6094"/><!--MD5=[69f2f3ad3645114d26612368d508f737]
class Printer--><rect codeLine="40" fill="#FEFECE" filter="url(#f2va1y7bly2yb)" height="214.4609" id="Printer" style="stroke:#A80036;stroke-width:1.5;" width="184" x="235.5" y="463"/><ellipse cx="302.25" cy="479" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M305.2188,484.6406 Q304.6406,484.9375 304,485.0781 Q303.3594,485.2344 302.6563,485.2344 Q300.1563,485.2344 298.8281,483.5938 Q297.5156,481.9375 297.5156,478.8125 Q297.5156,475.6875 298.8281,474.0313 Q300.1563,472.375 302.6563,472.375 Q303.3594,472.375 304,472.5313 Q304.6563,472.6875 305.2188,472.9844 L305.2188,475.7031 Q304.5938,475.125 304,474.8594 Q303.4063,474.5781 302.7813,474.5781 Q301.4375,474.5781 300.75,475.6563 Q300.0625,476.7188 300.0625,478.8125 Q300.0625,480.9063 300.75,481.9844 Q301.4375,483.0469 302.7813,483.0469 Q303.4063,483.0469 304,482.7813 Q304.5938,482.5 305.2188,481.9219 L305.2188,484.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="42" x="322.75" y="483.1543">Printer</text><line style="stroke:#A80036;stroke-width:1.5;" x1="236.5" x2="418.5" y1="495" y2="495"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="243.5" y="503"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="99" x="255.5" y="509.2104">stringstream oss</text><line style="stroke:#A80036;stroke-width:1.0;" x1="236.5" x2="418.5" y1="515.8047" y2="515.8047"/><ellipse cx="246.5" cy="526.8047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="116" x="255.5" y="530.0151">handle(Value&amp; expr)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="95" x="287.5" y="542.8198">oss &lt;&lt; de.value</text><ellipse cx="246.5" cy="552.4141" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="126" x="255.5" y="555.6245">handle(Addition&amp; add)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="61" x="287.5" y="568.4292">oss &lt;&lt; "("</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="70" x="287.5" y="581.2339">print(ae.left)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="66" x="287.5" y="594.0386">oss &lt;&lt; "+"</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="78" x="287.5" y="606.8433">print(ae.right)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="61" x="287.5" y="619.6479">oss &lt;&lt; ")"</text><ellipse cx="246.5" cy="629.2422" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="158" x="255.5" y="632.4526">handle(Multiplication&amp; mult)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="70" x="287.5" y="645.2573">print(ae.left)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="63" x="287.5" y="658.062">oss &lt;&lt; "*"</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="78" x="287.5" y="670.8667">print(ae.right)</text><!--MD5=[8e7b4fdb525ee12c3e8d624d9db4aaa7]
class Evaluator--><rect codeLine="57" fill="#FEFECE" filter="url(#f2va1y7bly2yb)" height="99.2188" id="Evaluator" style="stroke:#A80036;stroke-width:1.5;" width="184" x="454.5" y="520.5"/><ellipse cx="512.75" cy="536.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M515.7188,542.1406 Q515.1406,542.4375 514.5,542.5781 Q513.8594,542.7344 513.1563,542.7344 Q510.6563,542.7344 509.3281,541.0938 Q508.0156,539.4375 508.0156,536.3125 Q508.0156,533.1875 509.3281,531.5313 Q510.6563,529.875 513.1563,529.875 Q513.8594,529.875 514.5,530.0313 Q515.1563,530.1875 515.7188,530.4844 L515.7188,533.2031 Q515.0938,532.625 514.5,532.3594 Q513.9063,532.0781 513.2813,532.0781 Q511.9375,532.0781 511.25,533.1563 Q510.5625,534.2188 510.5625,536.3125 Q510.5625,538.4063 511.25,539.4844 Q511.9375,540.5469 513.2813,540.5469 Q513.9063,540.5469 514.5,540.2813 Q515.0938,540 515.7188,539.4219 L515.7188,542.1406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="59" x="533.25" y="540.6543">Evaluator</text><line style="stroke:#A80036;stroke-width:1.5;" x1="455.5" x2="637.5" y1="552.5" y2="552.5"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="462.5" y="560.5"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="43" x="474.5" y="566.7104">int total</text><line style="stroke:#A80036;stroke-width:1.5;" x1="455.5" x2="637.5" y1="573.3047" y2="573.3047"/><ellipse cx="465.5" cy="584.3047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="116" x="474.5" y="587.5151">handle(Value&amp; expr)</text><ellipse cx="465.5" cy="597.1094" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="126" x="474.5" y="600.3198">handle(Addition&amp; add)</text><ellipse cx="465.5" cy="609.9141" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="158" x="474.5" y="613.1245">handle(Multiplication&amp; mult)</text><!--MD5=[6b80e7eb9da08f51a279413cdef32010]
reverse link Expression to Value--><path codeLine="15" d="M395.85,68.64 C377.03,85.61 354.96,105.51 337.23,121.49 " fill="none" id="Expression-backto-Value" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="391.19,63.42,410.74,55.23,400.57,73.82,391.19,63.42" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[345e47141b068175f89006910964ebf2]
reverse link Expression to Addition--><path codeLine="16" d="M436.5,75.43 C436.5,88.33 436.5,102.32 436.5,114.71 " fill="none" id="Expression-backto-Addition" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="429.5,75.23,436.5,55.23,443.5,75.23,429.5,75.23" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[63c9ce6490a68e64108c49f24a1a31da]
reverse link Expression to Multiplication--><path codeLine="17" d="M482.91,67.63 C502.38,82.58 525,99.95 544.54,114.95 " fill="none" id="Expression-backto-Multiplication" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="478.35,72.96,466.75,55.23,486.88,61.85,478.35,72.96" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[12460443248f6cba70f77ca6c593dca0]
link Visitor to Handler--><!--MD5=[b3ec594c88d7c9df572e00ae0a4e4f91]
reverse link Handler to Visitor--><path codeLine="65" d="M210.28,297.45 C215.15,296.82 220.02,296.27 224.89,295.8 " fill="none" id="Handler-backto-Visitor" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="211.09,304.4,190.26,300.49,208.98,290.56,211.09,304.4" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[b94891c7bad610e60d86df326fe48107]
reverse link Visitor to Printer--><path codeLine="66" d="M393.81,421.79 C387.78,435.18 381.54,449.01 375.43,462.6 " fill="none" id="Visitor-backto-Printer" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="387.57,418.6,402.16,403.24,400.33,424.35,387.57,418.6" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[55eb4365cca98c16848c70fe541b6da4]
reverse link Visitor to Evaluator--><path codeLine="67" d="M479.5,421.6 C494.82,455.31 511.45,491.9 524.31,520.18 " fill="none" id="Visitor-backto-Evaluator" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="473.06,424.34,471.15,403.24,485.8,418.55,473.06,424.34" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[fa0cd518bacf322edfb293376920e7b5]
reverse link Multiplication to Visitor--><path codeLine="69" d="M545.36,204.2 C532.69,218.26 518.67,233.82 505.03,248.96 " fill="none" id="Multiplication-backto-Visitor" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="none" points="540.42,199.23,559.01,189.06,550.82,208.6,540.42,199.23" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[8b578497b238af4bd4fbb739952a57a7]
reverse link Addition to Visitor--><path codeLine="70" d="M436.5,209.25 C436.5,221.94 436.5,235.61 436.5,248.96 " fill="none" id="Addition-backto-Visitor" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="none" points="429.5,209.06,436.5,189.06,443.5,209.06,429.5,209.06" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[cbfd9ec4199fa8f1002002349243ae02]
reverse link Value to Visitor--><path codeLine="71" d="M339.68,198.85 C351.49,214.23 364.99,231.81 378.08,248.88 " fill="none" id="Value-backto-Visitor" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="none" points="333.81,202.7,327.19,182.57,344.92,194.17,333.81,202.7" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[9febff3e14ba73eda35ad603a8effa1b]
@startuml

abstract class Expression {
}
class Value {
-int value
}
class Addition {
-Expression& lhs
-Expression& lhs
}
class Multiplication {
-Expression& lhs
-Expression& lhs
}
Expression <|- - Value
Expression <|- - Addition
Expression <|- - Multiplication

together {
abstract class Handler {
+ {abstract} handle(Value& expr)
+ {abstract} handle(Addition& add)
+ {abstract} handle(Multiplication& mult)
}

abstract class Visitor {
- map<type_index, function<void(Expression &)>> type_map
- -
- template <typename E> void castAndHandle(Expression &expr)
..
//Internal double dispatch
auto casted = static_cast<T &>(expr);
handle(casted);
+ void accept(Expression &expr)
..
//search type_map and call the specialized castAndHandle(Expression&)
}
}

class Printer {
-stringstream oss
- -
+ handle(Value& expr)
\toss << de.value
+ handle(Addition& add)
\toss << "("
\tprint(ae.left)
\toss << "+"
\tprint(ae.right)
\toss << ")"
+ handle(Multiplication& mult)
\tprint(ae.left)
\toss << "*"
\tprint(ae.right)
}

class Evaluator {
-int total
+ handle(Value& expr)
+ handle(Addition& add)
+ handle(Multiplication& mult)
}

Visitor -[hidden] Handler
Handler <|- - Visitor
Visitor <|- - Printer
Visitor <|- - Evaluator

Multiplication <|.. Visitor
Addition <|.. Visitor
Value <|.. Visitor
	
@enduml

PlantUML version 1.2021.00(Sun Jan 10 15:55:05 IST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: ANSI_X3.4-1968
Language: en
Country: US
--></g></svg>